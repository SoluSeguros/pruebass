<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Lector de CÃ³digos QR</title>

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#0f172a">

<!-- LIBRERÃA QR -->
<script src="https://unpkg.com/html5-qrcode@2.3.10/html5-qrcode.min.js"></script>

<style>
:root{
  --bg:#0b1220;
  --card:#0f172a;
  --ink:#e5e7eb;
  --muted:#94a3b8;
  --line:rgba(255,255,255,.12);
  --brand:#1663ff;
  --ok:#22c55e;
  --bad:#ef4444;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--ink);
}

header{
  background:#0f172a;
  padding:14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:1px solid var(--line);
}

header h1{
  font-size:18px;
  margin:0;
}

main{
  padding:16px;
  max-width:600px;
  margin:auto;
}

.card{
  background:var(--card);
  border-radius:16px;
  border:1px solid var(--line);
  padding:14px;
  margin-bottom:16px;
}

.controls{
  display:flex;
  gap:8px;
  margin-bottom:10px;
}

button{
  flex:1;
  padding:10px;
  border-radius:12px;
  border:none;
  font-weight:700;
  cursor:pointer;
}

.btn-start{background:var(--brand); color:white}
.btn-stop{background:var(--bad); color:white}
button:disabled{opacity:.5}

#reader{
  width:100%;
  min-height:300px;
  border-radius:12px;
  overflow:hidden;
  border:1px solid var(--line);
  background:black;
}

.status{
  margin-top:10px;
  padding:8px;
  border-radius:10px;
  font-size:14px;
  text-align:center;
  border:1px solid var(--line);
}

.status.ok{color:var(--ok)}
.status.bad{color:var(--bad)}

.result{
  margin-top:12px;
  background:rgba(255,255,255,.05);
  border-radius:12px;
  padding:10px;
  border:1px solid var(--line);
  word-break:break-word;
  font-family:monospace;
}

ul{
  list-style:none;
  padding:0;
  margin:0;
}

li{
  padding:8px;
  border-bottom:1px solid var(--line);
  font-size:13px;
  word-break:break-word;
}
</style>
</head>

<body>

<header>
  <h1>ðŸ“· Lector QR</h1>
</header>

<main>

  <div class="card">
    <div class="controls">
      <button id="startBtn" class="btn-start">Iniciar</button>
      <button id="stopBtn" class="btn-stop" disabled>Detener</button>
    </div>

    <div id="reader"></div>

    <div id="status" class="status">Listo</div>

    <div class="result" id="result">â€”</div>
  </div>

  <div class="card">
    <b>Historial</b>
    <ul id="history"></ul>
  </div>

</main>

<audio id="beep">
  <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=" type="audio/wav">
</audio>

<script>
let scanner = null;
let lastQR = "";
let lastTime = 0;

const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const statusEl = document.getElementById("status");
const resultEl = document.getElementById("result");
const historyEl = document.getElementById("history");
const beep = document.getElementById("beep");

function setStatus(text, type=""){
  statusEl.textContent = text;
  statusEl.className = "status " + type;
}

startBtn.onclick = async () => {
  if(location.protocol !== "https:" && location.hostname !== "localhost"){
    alert("La cÃ¡mara SOLO funciona en HTTPS o localhost");
    return;
  }

  scanner = new Html5Qrcode("reader");

  startBtn.disabled = true;
  stopBtn.disabled = false;
  setStatus("Escaneando...", "ok");

  try{
    await scanner.start(
      { facingMode:"environment" },
      { fps:12, qrbox:250 },
      (text)=>{
        const now = Date.now();
        if(text === lastQR && now-lastTime < 1500) return;

        lastQR = text;
        lastTime = now;

        resultEl.textContent = text;
        setStatus("QR leÃ­do âœ”", "ok");
        beep.play().catch(()=>{});

        const li = document.createElement("li");
        li.textContent = new Date().toLocaleTimeString()+" â†’ "+text;
        historyEl.prepend(li);
      }
    );
  }catch(e){
    console.error(e);
    setStatus("Error al abrir cÃ¡mara", "bad");
    startBtn.disabled = false;
    stopBtn.disabled = true;
  }
};

stopBtn.onclick = async () => {
  if(scanner){
    await scanner.stop();
    await scanner.clear();
    scanner = null;
  }
  startBtn.disabled = false;
  stopBtn.disabled = true;
  setStatus("Detenido");
};
</script>

</body>
</html>






